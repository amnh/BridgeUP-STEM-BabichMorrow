---
title: "Partitioning Occurrence Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Partitioning data

Just as in our machine learning tutorials with the iris and sloth skull datasets, we need to find a way to split our data into test and training data to check how well our model is working. In biodiversity research, scientists typically accomplish this by splitting up their datasets into subsets. This allows us to perform k-fold cross validation, where the data is partitioned into k different subsets. Then the model is built multiple times using all subsets but one and testing the resulting model on the left-out group. This process results in k models.

We are going to use one kind of partitioning for *B. variegatus* and another for *B. tridactylus* and *B. torquatus*. If you are assigned to *B. variegatus*, read over the *Non-spatial partitions* section of this tutorial (without running any of the code, just get a grasp of what is happening conceptually), and then run the *Spatial partitions* section. If you are assigned to either *B. tridactylus* or *B. torquatus*, read over the *Spatial partitions* section and then run through the code in th *Non-spatial partitions* section.

**Try it yourself:** To get started, load the `ENMeval` package. Then import the csv of your occurrence points (you probably already have this imported from the previous Rmd).

```{r}

```


## Non-spatial partitions

Typically, non-spatial partitions are used either when there is no sampling bias (which is rarely true, particularly in our case), or when there are only a small number of occurrences.

For small sample sizes, which we have with both *B. tridactylus* and *B. torquatus*, we are going to use the jackknife partition, where each occurrence record is put in its own group. (How many models would result from such a partition? Can you see why we don't use this method for species with many occurrence points?)

To create a jackknife partition, we are going to use the `ENMeval` function `getjackknife()`.

**Try it yourself:** Read the Help menu for `get.jackknife()`. Fill in the code below to include the occurrence data and the background coordinates you created in `background_region_tutorial.Rmd`. Look at the resulting object -- you can see the group number for each occurrence point and background point.

```{r}
group.data <-
# Look at group.data
group.data
```

We can separately pull out the block numbers for the occurrence points and the background points in the following way:

```{r}
# pull out the occurrence and background partition group numbers from the list
occs.grp <- group.data[[1]]
bg.grp <- group.data[[2]]
```

Notice the double square brackets `[[ ]]`: they get the first and second items from the list `group.data` (where the first item is the group numbers for the occurrence points and the second item is the group numbers for the background points).

### Visualize partition

Now we can view our points on a map based on what partition group they are in.

The following code should look familiar -- it allows us to look at a satellite map of South America:

```{r}
library(ggmap)
#Use Google maps
api_key = "AIzaSyBK7lLbqoqnYFdzf-idYYposb-1gwyRAlQ"
register_google(key = api_key)
# Create bounding box to view South America
SA_bbox <- make_bbox(lon = c(-95, -25), lat = c(-35,20), f = 0.1)
SA_map <- get_map(location = SA_bbox, source = "google", maptype = "satellite")
ggmap(SA_map)
```

Now we can use `ggmap` to visualize our occurrence points colored by their partition group number.

**Try it yourself:** Complete the following code to specify the occurrence data and the column names for latitude and longitude in your dataset of occurrence points for your sloth species. Finally, color the points by `occs.grp` so the point(s) in each group are a different color:

```{r}
ggmap(SA_map) +
  geom_point(data = , aes(x=, y=), color = )
```


## Spatial partitions

Spatial partitions are preferred in situations where sampling bias exists and when we want to apply the model to different geographic regions and time periods. There are several methods of spatial partitioning; for *B. variegatus*. we are going to focus on block partitioning in particular.

The block method draws a horizontal and vertical line to divide the occurrences into 4 regions (the blocks). These blocks will each hold a similar number of occurrences but can differ in area. This method can be particularly useful because it will divide the occurrences up into groups that share similar geographic region, for example, the Central American sloths, the mid-Amazon sloths, the Atlantic Forest sloths, etc.

To create the block partition, we are going to use the `ENMeval` function `get.block()`.

**Try it yourself:** Read the Help menu for `get.block()`. Fill in the code below to include the occurrence data and the background coordinates you created in `background_region_tutorial.Rmd`. Look at the resulting object -- you can see the group number for each occurrence point and background point.

```{r}
group.data <-
# Look at group.data
group.data
```

We can separately pull out the block numbers for the occurrence points and the background points in the following way:

```{r}
# pull out the occurrence and background partition group numbers from the list
occs.grp <- group.data[[1]]
bg.grp <- group.data[[2]]
```

### Visualize partition

Now we can view our points on a map based on what partition group they are in.

The following code should look familiar -- it allows us to look at a satellite map of South America:

```{r}
library(ggmap)
#Use Google maps
api_key = "AIzaSyBK7lLbqoqnYFdzf-idYYposb-1gwyRAlQ"
register_google(key = api_key)
# Create bounding box to view South America
SA_bbox <- make_bbox(lon = c(-95, -25), lat = c(-35,20), f = 0.1)
SA_map <- get_map(location = SA_bbox, source = "google", maptype = "satellite")
ggmap(SA_map)
```

Now we can use `ggmap` to visualize our occurrence points colored by their partition group number.

**Try it yourself:** Complete the following code to specify the occurrence data and the column names for latitude and longitude in your dataset. Finally, color the points by `occs.grp`:

```{r}
ggmap(SA_map) +
  geom_point(data = , aes(x=, y=), color = )
```

We can also visualize the block partition by looking at the partition groups for the background data.

**Try it yourself:** Modify the above code to instead see the background points (`bg.xy`) you created colored by their group number (`bg.grp`). You will have to change the x and y column names.

```{r}

```






