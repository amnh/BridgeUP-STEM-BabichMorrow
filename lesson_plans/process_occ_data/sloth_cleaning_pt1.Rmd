---
title: "Sloth Data Cleaning - Part 1: Subsetting"
output:
  html_notebook: default
  pdf_document: default
---

## What is data cleaning?

Usually, the dataset we first get is not the dataset we want to end up with. Datasets often come in unhelpful formats, don't contain all the information we need (or contain too much information), or even have incorrect entries (like a sloth observation in the middle of the ocean). Data cleaning is the process of taking the (usually crummy) data you start with and making it useful, informative, and accurate.

We are going to take the dataframe that you obtained at the end of the `spocc` tutorial, and use it to learn some critical data cleaning skills in R.

## Selecting and deleting variables

Just like Python, R has ways for you to access certain parts of a dataset. This is super helpful in data cleaning -- if you want to get rid of a sloth occurrence point in the Atlantic Ocean, you have to be able to select that value out of your dataset.

The most basic way of subsetting a dataframe in R is by using square brackets `[]`. To pull out an individual cell in a dataframe, you use square brackets and the row/column number of that cell.

**Try it yourself:** Look at your dataframe using the `View()` function. Pick a particular cell in the dataframe, like a certain latitude value or date. See if you can extract just that cell from the dataframe using the row and column number -- remember the syntax is `[row number, column number]`

```{r}
sp_df[]
```


### Selecting variables

You can select out certain variables from your dataframe. For example, let's say we only care about the latitude and longitude columns. There are a couple ways we could extract just those two columns -- the first uses the column names.

```{r}
#select latitude and longitude columns
latlong_vars <- c("latitude", "longitude")
newdata1 <- sp_df[latlong_vars]
View(newdata1)
```


**Try it yourself:** Another way of ending up with the same two columns is to select the columns by column number, rather than column name. Find the column numbers of the latitude and longitude columns, and put them in the square brackets below. Be careful -- we want to make sure that we don't select out only a single cell from the dataframe. You can use `c()` to create a vector of the columns you want (for example `c(4,6)` would get you the 4th and 6th columns), or use `:` (for example `3:5` would get you the 3rd, 4th, and 5th columns) to indicate a range of column numbers.

```{r}
newdata2 <- sp_df[]
View(newdata2)
```

### Selecting rows

We can also select out certain rows from our dataframe. To get a certain row with all of the columns included, run the following:

```{r}
#print the first row of the dataframe
sp_df[1,]
```

**Try it yourself:** Use the syntax above to extract a range of rows from your dataframe. Again, you will have to use `c()` or `:` to indicate that you want more than one row.

```{r}

```


### Excluding variables

Sometimes it's more convenient to tell R what columns you want to get rid of, rather than specifying which you want to keep. Let's say we want to get rid of the column `prov` since we know all of our data comes from GBIF.

```{r}
newdata3 <- sp_df[-4]
View(newdata3)
```

We can also do this using the column names, although the syntax is a little trickier than it was for selecting variables:

```{r}
drop_vars <- names(sp_df) %in% "prov"
newdata4 <- sp_df[!drop_vars]
```

**Try it yourself:** Let's break that code down a little bit. Run `names(sp_df)` -- what do you get? Now run the part of the first line to the right of `<-`. What do you think `%in%` does? You can use the help menu to learn a little more about `%in%`.

```{r}
names(sp_df)
names(sp_df) %in% "prov"
```


**Try it yourself:** Now try dropping multiple columns from the dataset. Let's say, in this case, that we no longer care about occurrence date. Modify the above code to get rid of the data from the columns `prov` and `date`:
```{r}

```

## Selection by data value

Oftentimes, we don't immediately know enough about our data to pick out a particular cell from our dataframe that might be of interest. Instead, we want to be able to pull out all observations with a particular value for one of our variables.

### `which()` function

For example, let's say we want to look at all of our observations within a particular band of latitude:

```{r}
#subset the data to select observations with latitude between -5 and 5 degrees
which_obs <- sp_df[ which(sp_df$latitude > -5 & sp_df$latitude < 5), ]
View(which_obs)

#plot the observations in our dataset that have latitude values between -5 and 5
ggmap(bbox_map) +
  geom_point(data = which_obs, aes(x = longitude, y = latitude),
             color = "green",
             size = 1)
```

Notice the `which()` function within the square brackets: `which()` returns the indices where a given logical statement is true.

**Try it yourself:** Run just the `which()` portion of the above code. By nesting `which()` within the square brackets, we are basically doing the same thing we did earlier when we specified certain row numbers to keep, only this time we are letting `which()` do the work of picking out the rows.

```{r}
which(sp_df$latitude > -5 & sp_df$latitude < 5)
```

### `subset()` function

As an alternative to using the square brackets and the `which()` function, R also has a handy `subset()` function. `subset()` takes 3 arguments (one of which is optional):

1. `x`: the data/object you want to subset
2. `subset`: the logical expression you want to subset by
3. `select`: the columns you want to use in your data (if you don't include this, you'll end up with all of the columns of your original data).

For example, this code replicates what we ran above using `which()` to select observations between -5 and 5 degrees latitude:

```{r}
subset_obs <- subset(sp_df, latitude > -5 & latitude < 5)
View(subset_obs)
```

Notice we didn't add in `select`, so we got all of the same columns that our original dataframe had.

**Try it yourself:** Use the `select` argument to extract only the `latitude` and `longitude` columns -- you can use the column names (no quotation marks):

```{r}
subset_obs2 <- subset(sp_df, latitude > -5 & latitude < 5, select = )
View(subset_obs2)
```

## Sloth data cleaning

**Try it yourself:** Pick a different latitude or longitude (or both) range of occurrences to plot. You can use either `which()` or `subset()`. You can use `>`, `<`, `<=`, `>=`, `==`, or `!=` to specify values you do (or don't) want included. You can also use `&` to specify multiple conditions that must all be true. If you want to be really fancy, you could also use `|`, which means "or" in R. All of these symbols known as *logical operators*.

```{r}

```

**Try it yourself:** Look at your dataset -- is there a particular datapoint that seems inaccurate? Work with your group to figure out how to isolate that point. Can you estimate its latitude or longitude? If so, can you subset your data by that range of latitude and longitude to find what row that observation is in? How could you delete that row?

```{r}

```

