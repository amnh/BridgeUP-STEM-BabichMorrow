---
title: "Sloth Data Cleaning - Part 3: Spatial Thinning"
output: html_notebook
---

## Introduction

Now that we've used subsetting and polygons to remove incorrect occurrence records and NA values from our dataset, we are almost done with data cleaning! The last problem with our data is spatial bias, where occurrence records are clustered in certain areas based on sampling effort. We can use the `spThin` package to try to remove some of the spatial bias from our data.

## `spThin`

**Try it yourself:** Install and load the `spThin` package:

```{r}

```

The main function in `spThin` is `thin()`, which runs a spatial thinning algorithm on occurrence data given a certain "thinning parameter", which is the distance you want records to be separated by. Read the help menu for `thin()` and try to predict what we need to put in the function.

We are going to start off by thinning to 10 km, using the data you subsetted with your polygon.

**Try it yourself:** Complete the code below by filling in: (1) the name of the dataframe of occurrences subsetted with your polygon, (2) the column name of the latitude column, (3) the column name of the longitude column, and (3) the column name of the species column (make sure to put quotation marks around the column names).

```{r}
thinned_output <- thin(loc.data = , lat.col = , long.col = , spec.col = , thin.par = 10, reps = 100, locs.thinned.list.return = TRUE, write.files = FALSE)
```

Now use `View()` to see what `thinned_occs` looks like. It is a list of 100 data frames, one from each repetition of the algorithm. We want to select one of these. We want a data frame with as many occurrences as possible, so we can use `sapply()` to find out which of the 100 data frames has the maximum number of rows.

```{r}
maxThin <- which(sapply(thinned_output, nrow) == max(sapply(thinned_output, nrow)))
```

If more than one of the data frames has the maximum number of rows, we can just pick the first one. Double square brackets (`[[ ]]`) select out one of the data frames.

```{r}
if(length(maxThin) > 1){
  maxThin <- thinned_output[[ maxThin[1] ]]
} else{
  maxThin <- thinned_output[[maxThin]]
}
```

**Try it yourself:** Check out the if-else statement above -- this is one of the first conditionals we've worked with in R. Make sure you understand what each part does. Look at the data frame `maxThin` (paying attention to the row numbers).


